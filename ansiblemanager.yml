- name: "ansiblemanager"
  hosts: all
  tasks:
  - name: "ansiblemanager | install git"
    ansible.builtin.package:
      name: git
      state: latest

  - name: "Ansiblemanager | clone the main ansible manager network"
    ansible.builtin.git:
      repo: "git@github.com:JakobHolstDK/openknowit_ansibleautomation_main.git"
      dest: /opt/openknowit_ansibleautomation_main
      single_branch: yes
      force: yes
      version: main
    become: yes
    
  - name: "ansiblemanager | ensure systemd user directory exitst"
    ansible.builtin.file:
      path: ~/.config/systemd/user
      state: directory
      mode: '0755'
  
  - name: "ansiblemanager | copy service file to manager"
    ansible.builtin.copy:
      src: aaoaa.service
      dest: ~/.config/systemd/user/aaoaa.service
      mode: '0644'      
    notify: 
      - "restart ansiblemanager service"

  - name: "ansiblemanager | Ensure ansible manager serivice is runnig"
    service: 
      name: "aaoaa"
      state: started
      enabled: true

  handlers:
    - name: "restart ansiblemanager service"
      service: 
        name: "aaoaa"
        state: restarted

